<!doctype html>
<html lang="es">
    {% block content_header %}
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <title>Logs Mensajes</title>
        <meta name="author" content="Raziel Valle Miranda">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="HandheldFriendly" content="true">
        <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
        {% stylesheets 'bundles/fractaliasms/css/*' filter='cssrewrite' %}
        <link rel="stylesheet" href="{{ asset( asset_url) }}"/>
        {% endstylesheets %}

        {% javascripts
            '@FractaliaSmsBundle/Resources/public/js/jquery-1.11.0.min.js'
            '@FractaliaSmsBundle/Resources/public/js/retina.js'
            '@FractaliaSmsBundle/Resources/public/js/main.js'
            output='js/compiled/javascripts.js'
        %}
        <script type="text/javascript" src="{{ asset( asset_url) }}"></script>
        {% endjavascripts %}
        <!--[if lt IE 9]>
          <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
          <script src="http://css3-mediaqueries-js.googlecode.com/svn/trunk/css3-mediaqueries.js"></script>
        <![endif]-->
        <link rel="shortcut icon" type="image/x-icon" href="{{ asset('favicon.ico') }}" />
        <link rel="icon" type="image/x-icon" href="{{ asset('favicon.ico') }}" />
    {%endblock%}

    {% block body -%}
        <div id="view">
            <header>
                <h1>Log Mensajes</h1>
                <div id='cssmenu'>
                    <ul>
                        <li><a href='#'><span>Configuraciones</span></a></li>
                        <li><a href='#'><span>Ver/Modificar Tsol</span></a>
                            <ul>
                                <li id="show_tsol"><a id="click_editar" href='#' title="Click Para editar">{{tsol.nombre}}</a></li>
                            </ul>
                        </li>
                        <li><a href='#'><span>Gestionar Nombres Cortos</span></a>
                            <ul id="ncortos">
                                {%for ncorto in nombres %}
                                    <li id="show_nombre_{{ncorto.id}}"><a class="editar_nombre" href='#' data-location="{{ path('nombrecorto_editar', { 'id': ncorto.id }) }}" data-shortnameid="{{ncorto.id}}" title="Click para editar">{{ncorto.nombre}}</a></li>
                                    {%endfor%}
                                <li id="add_more"><a id="add_nombre" href='#' title="Click para agregar"><span>AÃ±adir nombre corto</span></a>
                            </ul>
                        </li>
                    </ul>
                </div>
            </header>

            <div id="container">
                <ul>
                    {%set namepic = "" %}
                    {% for entity in entities %}
                        {%if entity.estadoenvio == 'ERROR_BUILD' or entity.estadoenvio == 'ERROR' %}
                            <a href="{{ path('mensajes_edit', { 'id': entity.id }) }}">
                            {%elseif entity.estadoenvio == 'ENVIADO' or entity.estadoenvio == 'POR_ENVIAR' %}
                                <a href="{{ path('mensajes_show', { 'id': entity.id }) }}">
                                {%endif%}
                                <li class="clearfix">
                                    {% set namepic = entity.destinatario | lower %}
                                    {% image '@FractaliaSmsBundle/Resources/public/images/icon-default.png' %}
                                    <img src="{{ asset_url }}" alt="thumb" class="thumbnail"/>
                                    {% endimage %}
                                    <h2>
                                        {%if entity.estadoenvio == 'ERROR_BUILD' %}
                                            ERROR EN EL MENSAJE  (grupo envio: {{ entity.destinatario }})
                                        {%elseif entity.estadoenvio == 'ERROR' %}
                                            ERROR EN LOS DATOS   (grupo envio: {{ entity.destinatario }})                              
                                        {%elseif entity.estadoenvio == 'ENVIADO' %}
                                            {{ entity.estadoenvio }} al grupo: {{ entity.destinatario }}
                                        {%elseif entity.estadoenvio == 'POR_ENVIAR' %}
                                            MENSAJE POR ENVIAR al grupo: {{ entity.destinatario }}
                                        {%endif%}
                                    </h2>
                                    <p class="desc">{{entity.mensaje.tipomensaje}} {{entity.mensaje.texto|slice(0, 23)}}...</p>
                                    <span class="price">
                                        {% if entity.fechaEnvio %}
                                            Enviado: {{ entity.fechaEnvio|date('d/m/y H:i:s') }}
                                        {% elseif entity.fechaCreacion %}
                                            Creado: {{ entity.fechaCreacion|date('d/m/y H:i:s') }}
                                        {% endif %}
                                    </span>
                                </li></a>

                        {% endfor %}
                </ul>
            </div>
        </div>
        <script>
            {#  Jquery para Manipular tsol #}
                $(document).on("click", "#click_editar", function(event) {
                    event.preventDefault();
                    $.ajax({
                        url: "{{ path('tsol_editar', { 'id': tsol.id }) }}",
                        type: "GET",
                        dataTpe: "html",
                        context: document.body
                    }).done(function(msg) {
                        $("#show_tsol").html(msg);
                    });
                });
                $(document).on("click", "#pi2_fractalia_smsbundle_nombretsol_submit", function(event) {
                    var val = $("#pi2_fractalia_smsbundle_nombretsol_nombre").val();
                    var form = $('form[name="pi2_fractalia_smsbundle_nombretsol"]');
                    if (val != '') {
                        event.preventDefault();
                        $.ajax({
                            type: "POST",
                            cache: false,
                            url: form.attr('action'),
                            data: form.serialize(),
                            success: function(data) {
                                $("#show_tsol").html(data);
                            }
                        });
                    }
                });
            {#  FIN Jquery para Manipular tsol #}
            {#  Jquery para Manipular Nombres Cortos #}
                $(document).on("click", "a.editar_nombre", function(event) {
                    $.ajax({
                        url: "{{ path('nombrecorto_editar', { 'id': 1 }) }}",
                        type: "GET",
                        dataTpe: "html",
                        context: document.body
                    }).done(function(msg) {
                        $("#show_nombre_1").html(msg);
                    });
                });

                $(document).on("click", "#pi2_fractalia_smsbundle_nombrecorto_submit", function(event) {
                    var val = $("#pi2_fractalia_smsbundle_nombrecorto_nombre").val();
                    var form = $('form[name="pi2_fractalia_smsbundle_nombrecorto"]');
                    if (val != '') {
                        event.preventDefault();
                        $.ajax({
                            type: "POST",
                            cache: false,
                            url: form.attr('action'),
                            data: form.serialize(),
                            success: function(data) {
                                alert(data);
            {#                            $("#show_tsol").html(data);#}
                                $.ajax({
                                    url: "{{ path('nombrecorto_mostrar') }}",
                                    type: "GET",
                                    dataTpe: "html",
                                    context: document.body
                                }).done(function(msg) {
                                    $("#ncortos").html(msg);
                                });
                            }
                        });
                    }
                });
            {#  FIN Jquery para Manipular Nombres Cortos #}



        </script>
    {% endblock %}
